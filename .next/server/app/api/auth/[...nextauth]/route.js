(()=>{var e={};e.id=14,e.ids=[14],e.modules={96330:e=>{"use strict";e.exports=require("@prisma/client")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},12412:e=>{"use strict";e.exports=require("assert")},79428:e=>{"use strict";e.exports=require("buffer")},55511:e=>{"use strict";e.exports=require("crypto")},94735:e=>{"use strict";e.exports=require("events")},81630:e=>{"use strict";e.exports=require("http")},55591:e=>{"use strict";e.exports=require("https")},11723:e=>{"use strict";e.exports=require("querystring")},79551:e=>{"use strict";e.exports=require("url")},28354:e=>{"use strict";e.exports=require("util")},74075:e=>{"use strict";e.exports=require("zlib")},66562:(e,r,t)=>{"use strict";t.r(r),t.d(r,{patchFetch:()=>w,routeModule:()=>p,serverHooks:()=>h,workAsyncStorage:()=>d,workUnitAsyncStorage:()=>m});var s={};t.r(s),t.d(s,{GET:()=>c,POST:()=>c});var i=t(42706),a=t(28203),o=t(45994),n=t(51825),u=t.n(n),l=t(42442);let c=u()(l.f),p=new i.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/auth/[...nextauth]/route",pathname:"/api/auth/[...nextauth]",filename:"route",bundlePath:"app/api/auth/[...nextauth]/route"},resolvedPagePath:"E:\\Deepak aashrmiyas work place\\DeepakMERNIntern\\mtb\\app\\api\\auth\\[...nextauth]\\route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:d,workUnitAsyncStorage:m,serverHooks:h}=p;function w(){return(0,o.patchFetch)({workAsyncStorage:d,workUnitAsyncStorage:m})}},96487:()=>{},78335:()=>{},42442:(e,r,t)=>{"use strict";t.d(r,{f:()=>c});var s=t(96330),i=t(28053),a=t(91642);let o=require("bcrypt");var n=t.n(o),u=t(56199);let l=new s.PrismaClient,c={providers:[(0,i.A)({clientId:process.env.GOOGLE_CLIENT_ID,clientSecret:process.env.GOOGLE_SECRET_KEY}),(0,a.A)({name:"Credentials",credentials:{email:{label:"Email",type:"email"},password:{label:"Password",type:"password"},rememberMe:{label:"Remember Me",type:"checkbox"}},async authorize(e){try{console.log("credentials",e);let r=await l.user.findUnique({where:{email:e?.email,authMethod:s.AuthMethod.CREDENTIALS},include:{plan:!0}});if(!r)throw Error("No user found");if(!e?.password)throw Error("Password is required");if(!await n().compare(e.password,r.password))throw Error("Password is incorrect");return(0,u.K)(r,s.ActivityType.DAILY_LOGIN),{id:r.id,name:r.name,email:r.email,role:r.role,rememberMe:"true"===e.rememberMe}}catch(e){if(console.log("error",e),e instanceof Error)throw Error(e.message);throw Error("Something went wrong")}}})],callbacks:{async signIn({user:e,account:r}){if(r?.provider==="credentials")return!0;try{let r=await l.user.findUnique({where:{email:e.email}});if(console.log("user exists info",r),r&&r.authMethod===s.AuthMethod.CREDENTIALS)return"/signin?error=account-exists-with-credentials";if(r){if(r.authMethod===s.AuthMethod.CREDENTIALS)throw Error("This email is already registered with password login. Please use your password.");let t=await l.user.update({where:{email:e.email},data:{name:e.name,image:e.image?e.image:""},include:{plan:!0}});(0,u.K)(t,s.ActivityType.DAILY_LOGIN),console.log("user updated info",t),e.role=r.role,e.id=r.id}else{let r=e.email===process.env.ADMIN_EMAIL?"ADMIN":"USER";console.log(r);let t=await l.user.create({data:{role:r,email:e.email,name:e.name,image:e.image?e.image:"",authMethod:s.AuthMethod.GOOGLE},include:{plan:!0}});(0,u.K)(t,s.ActivityType.SIGNUP),console.log("user created info",t),e.role=t.role,e.id=t.id}return!0}catch(e){return console.error("Error saving user:",e),!1}},jwt:async({token:e,user:r})=>(console.log("check user",r),r&&(e.role=r.role,e.id=r.id,e.rememberMe=r.rememberMe??!1,console.log("remeberme tokencheck",e.rememberMe),e.maxAge=r.rememberMe?604800:2700),console.log("token",e),e),session:async({session:e,token:r})=>(e.user&&(console.log("token.role",r.role),e.user.role=r.role,e.user.id=r.id,e.user.rememberMe=r.rememberMe),console.log("sessiondata",e),e)},session:{strategy:"jwt",maxAge:2700},pages:{signIn:"/login"},secret:process.env.NEXTAUTH_SECRET}},56199:(e,r,t)=>{"use strict";t.d(r,{K:()=>i});let s=new(t(96330)).PrismaClient;async function i(e,r){try{let t=await s.activity.findUnique({where:{activity:r}});if(!t)throw Error(`Activity ${r} not found`);let i=!!e.planId&&(!e.planEnd||new Date<e.planEnd)&&e?.plan?.jpMultiplier||1,a=t.jpAmount*i;await s.user.update({where:{id:e.id},data:{jpEarned:{increment:a},jpBalance:{increment:a},jpTransaction:{increment:a},transaction:{create:{activityId:t.id}}}})}catch(e){throw console.error(e),e}}},42706:(e,r,t)=>{"use strict";e.exports=t(44870)}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[638,646],()=>t(66562));module.exports=s})();